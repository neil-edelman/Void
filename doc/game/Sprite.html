<!doctype html public "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>
<!-- steal these colour values from JavaDocs; meh -->
<style type = "text/css">
	a:link,  a:visited { color: #4a6782; }
	a:hover, a:focus   { color: #bb7a2a; }
	a:active           { color: #4A6782; }
	tr:nth-child(even) { background: #dee3e9; }
	div {
		margin:  4px 0;
		padding: 0 4px 4px 4px;
	}
	table      { width: 100%; }
	td         { padding: 4px; }
	h3, h1 {
		color: #2c4557;
		background-color: #dee3e9;
		padding:          4px;
	}
	h3 {
		margin:           0 -4px;
		padding:          4px;
	}
</style>
<title>BinSprite</title>
</head>


<body>

<h1>BinSprite</h1>

<ul>
	<li><a href = "#_declarations">Declarations</a></li>
	<li><a href = "#_summary">Function Summary</a></li>
	<li><a href = "#_detail">Function Detail</a></li>
</ul>

<p>
2017 Neil Edelman, distributed under the terms of the GNU General
Public License 3, see copying.txt, or
<a href = "https://opensource.org/licenses/GPL-3.0">https://opensource.org/licenses/GPL-3.0</a>.
</p>
<p>
Testing the bins. A <em>Bin</em> is like a hash bucket, but instead of hashing, it's
determined by where in space you are. This allows you to do stuff like drawing
and AI for onscreen bins and treat the faraway bins with statistical mechanics.
Which allows you to have a lot of sprites -&gt; ships, weapons -&gt; more epic.
</p>
<p>
Copyright 2015 Neil Edelman, distributed under the terms of the GNU General
Public License, see copying.txt.
</p>
<p>
Sprites have an <em>Ortho</em> location and are lit by <a href = "https://scholar.google.ca/scholar?q=lambert1892photometrie">lambert1892photometrie</a>.
They are drawn by the gpu in <em>../system/Draw</em> as the main foreground. Sprites
detect collisions. The sprite system must startup by calling <a href = "#Sprite">Sprite</a> and
can shutdown by calling <a href = "#Sprite_">Sprite_</a>. To instatiate an abstract <em>Sprite</em>, one
must call one of it's subclasses:
</p>
<ul>
	<li>
Debris: is everything that doesn't have license, but moves around on a
linear path, can be damaged, killed, and moved. Astroids and stuff.
	</li>
	<li>
Ship: has license and is controlled by a player or an ai.
	</li>
	<li>
Wmd: cannons, bombs, and other cool stuff that has sprites and can hurt.
	</li>
	<li>
Ethereal: are in the forground but poll collision detection instead of
interacting; they generally do something in the game. For example, gates are
devices that can magically transport you faster than light, or powerups.
	</li>
</ul>
<p>
Enforces the maximum speed by breaking the debris into smaller chunks; the
process is not elastic, so it loses energy (speed.)
</p>
<p>
Gets a read-only copy of the position.
</p>
<dl>
	<dt>minimum standard</dt>
	<dd>C89/90</dd>
	<dt>author</dt>
	<dd>Neil</dd>
	<dt>author</dt>
	<dd>Neil</dd>
	<dt>version</dt>
	<dd>3.4, 2017-05 generics</dd>
	<dt>since</dt>
	<dd>3.3, 2016-01
 			3.2, 2015-06</dd>
	<dt>fixme</dt>
	<dd>Change diameter to radius.</dd>
</dl>


<a name = "_declarations"><!-- --></a><h2>Declarations</h2>

<div><a name = "struct SpriteVt"><!-- --></a>
<h3>struct SpriteVt</h3>
<pre><b>struct SpriteVt</b></pre>
<p>
<em>Sprite</em> virtual table.
</p>
<dl>
</dl>
</div>

<div><a name = "struct Collision"><!-- --></a>
<h3>struct Collision</h3>
<pre><b>struct Collision</b></pre>
<p>
Collisions between two sprites, cleared at every frame.
</p>
<dl>
</dl>
</div>

<div><a name = "struct Sprite"><!-- --></a>
<h3>struct Sprite</h3>
<pre><b>struct Sprite</b> {
	const struct SpriteVt *vt; /* virtual table pointer */
	const struct AutoImage *image, *normals; /* what the sprite is */
	struct Collision *collision_set; /* temporary, \in collisions */
	unsigned bin; /* where, approximately, is the image between frames */
	struct Ortho3f x, v; /* where it is and where it is going */
	struct Vec2f dx, x_5; /* temporary values */
	float bounding, bounding1; /* bounding1 is temporary */
}</pre>
<p>
Define <em>Sprite</em>.
</p>
<dl>
</dl>
</div>

<div><a name = "static struct SpriteList bins[BIN_BIN_FG_SIZE]"><!-- --></a>
<h3>static struct SpriteList bins[BIN_BIN_FG_SIZE]</h3>
<pre><b>static struct SpriteList bins[BIN_BIN_FG_SIZE]</b></pre>
<p>
Every sprite has one <em>bin</em> based on their position. <a href = "#OrthoMath.h">OrthoMath.h</a>.
</p>
<dl>
</dl>
</div>

<div><a name = "struct SpriteVt"><!-- --></a>
<h3>struct SpriteVt</h3>
<pre><b>struct SpriteVt</b> {
	SpriteAction update, delete;
	SpriteToString to_string;
	SpriteFloatAccessor get_mass;
}</pre>
<p>
Define <em>SpriteVt</em>.
</p>
<dl>
</dl>
</div>

<div><a name = "struct ColourData"><!-- --></a>
<h3>struct ColourData</h3>
<pre><b>struct ColourData</b> {
	FILE *fp;
	const char *colour;
	unsigned object;
}</pre>
<p>
For communication with <em>gnu_draw_bins</em>.
</p>
<dl>
</dl>
</div>

<div><a name = "static struct SpriteList sprites[BIN_BIN_SIZE]"><!-- --></a>
<h3>static struct SpriteList sprites[BIN_BIN_SIZE]</h3>
<pre><b>static struct SpriteList sprites[BIN_BIN_SIZE]</b></pre>
<p>
Every sprite has one <em>bin</em> based on their position. <a href = "#OrthoMath.h">OrthoMath.h</a>.
</p>
<dl>
</dl>
</div>

<div><a name = "struct Debris"><!-- --></a>
<h3>struct Debris</h3>
<pre><b>struct Debris</b> {
	struct SpriteListNode sprite;
	int hit;
	/*void (*on_kill)(void); minerals? */
}</pre>
<p>
Define <em>Debris</em> as a subclass of <em>Sprite</em>.
</p>
<dl>
</dl>
</div>

<div><a name = "struct Ship"><!-- --></a>
<h3>struct Ship</h3>
<pre><b>struct Ship</b> {
	struct SpriteListNode sprite;
	const struct AutoShipClass *class;
	unsigned     ms_recharge_wmd; /* ms */
	unsigned     ms_recharge_hit; /* ms */
	struct Event *event_recharge;
	int          hit, max_hit; /* GJ */
	float        max_speed2;
	float        acceleration;
	float        turn; /* deg/s -> rad/ms */
	float        turn_acceleration;
	float        horizon;
	enum SpriteBehaviour behaviour;
	char         name[16];
}</pre>
<p>
Define <em>Ship</em> as a subclass of <em>Sprite</em>.
</p>
<dl>
</dl>
</div>

<div><a name = "struct Wmd"><!-- --></a>
<h3>struct Wmd</h3>
<pre><b>struct Wmd</b> {
	struct SpriteListNode sprite;
	const struct AutoWmdType *class;
	const struct Sprite *from;
	float mass;
	unsigned expires;
	unsigned light;
}</pre>
<p>
Define <em>Wmd</em> as a subclass of <em>Sprite</em>.
</p>
<dl>
</dl>
</div>

<div><a name = "struct Gate"><!-- --></a>
<h3>struct Gate</h3>
<pre><b>struct Gate</b> {
	struct SpriteListNode sprite;
	const struct AutoSpaceZone *to;
}</pre>
<p>
Define <em>Gate</em> as a subclass of <em>Sprite</em>.
</p>
<dl>
</dl>
</div>


<a name = "_summary"><!-- --></a><h2>Function Summary</h2>

<table>
<tr><th>Return Type</th><th>Function Name</th><th>Argument List</th></tr>
<tr>
	<td>struct Ship *</td>
	<td><a href = "#Ship">Ship</a></td>
	<td>const struct AutoShipClass *const class,
	const struct Ortho3f *const x, const enum AiType ai</td>
</tr>
<tr>
	<td>struct Debris *</td>
	<td><a href = "#Debris">Debris</a></td>
	<td>const struct AutoDebris *const class,
	const struct Ortho3f *const x</td>
</tr>
<tr>
	<td>struct Wmd *</td>
	<td><a href = "#Wmd">Wmd</a></td>
	<td>const struct AutoWmdType *const class,
	const struct Ship *const from</td>
</tr>
<tr>
	<td>struct Gate *</td>
	<td><a href = "#Gate">Gate</a></td>
	<td>const struct AutoGate *const class</td>
</tr>
<tr>
	<td>int</td>
	<td><a href = "#Sprites">Sprites</a></td>
	<td>void</td>
</tr>
<tr>
	<td>void</td>
	<td><a href = "#Sprites_">Sprites_</a></td>
	<td>void</td>
</tr>
<tr>
	<td>void</td>
	<td><a href = "#SpritesDrawInfo">SpritesDrawInfo</a></td>
	<td>InfoOutput draw</td>
</tr>
<tr>
	<td>void</td>
	<td><a href = "#SpritesDrawLambert">SpritesDrawLambert</a></td>
	<td>LambertOutput draw</td>
</tr>
<tr>
	<td>void</td>
	<td><a href = "#SpritesPlot">SpritesPlot</a></td>
	<td>void</td>
</tr>
<tr>
	<td>void</td>
	<td><a href = "#SpriteDebris">SpriteDebris</a></td>
	<td>const struct Sprite *const s</td>
</tr>
<tr>
	<td>int</td>
	<td><a href = "#Debris">Debris</a></td>
	<td>const struct AutoDebris *const class,
	struct Ortho3f *r, const struct Ortho3f *v</td>
</tr>
<tr>
	<td>struct Ship *</td>
	<td><a href = "#Ship">Ship</a></td>
	<td>const struct AutoShipClass *const class,
	struct Ortho3f *const r, const enum SpriteBehaviour behaviour</td>
</tr>
<tr>
	<td>int</td>
	<td><a href = "#Gate">Gate</a></td>
	<td>const struct AutoGate *const class</td>
</tr>
<tr>
	<td>int</td>
	<td><a href = "#Sprite">Sprite</a></td>
	<td>void</td>
</tr>
<tr>
	<td>void</td>
	<td><a href = "#Sprite_">Sprite_</a></td>
	<td>void</td>
</tr>
<tr>
	<td>void</td>
	<td><a href = "#SpriteOut">SpriteOut</a></td>
	<td>struct Sprite *const this</td>
</tr>
<tr>
	<td>void</td>
	<td><a href = "#SpriteUpdate">SpriteUpdate</a></td>
	<td>const int frame_ms</td>
</tr>
<tr>
	<td>inline const struct SpriteList *</td>
	<td><a href = "#SpriteListBin">SpriteListBin</a></td>
	<td>struct Vec2u bin2</td>
</tr>
<tr>
	<td>inline void</td>
	<td><a href = "#SpriteExtractDrawing">SpriteExtractDrawing</a></td>
	<td>const struct Sprite *const this,
	const struct Ortho3f **const r_ptr, unsigned *const image_ptr,
	unsigned *const normals_ptr, const struct Vec2u **const size_ptr</td>
</tr>
<tr>
	<td>void</td>
	<td><a href = "#ShipGetHit">ShipGetHit</a></td>
	<td>const struct Ship *const this, struct Vec2u *const hit</td>
</tr>
<tr>
	<td>int</td>
	<td><a href = "#WmdGetDamage">WmdGetDamage</a></td>
	<td>const struct Wmd *const this</td>
</tr>
<tr>
	<td>const struct AutoSpaceZone *</td>
	<td><a href = "#GateGetTo">GateGetTo</a></td>
	<td>const struct Gate *const this</td>
</tr>
<tr>
	<td>struct Gate *</td>
	<td><a href = "#GateFind">GateFind</a></td>
	<td>struct AutoSpaceZone *const to</td>
</tr>
</table>


<a name = "_detail"><!-- --></a><h2>Function Detail</h2>

<div><a name = "Ship"><!-- --></a>
<h3>Ship</h3>
<pre>struct Ship * <b>Ship</b> (const struct AutoShipClass *const class,
	const struct Ortho3f *const x, const enum AiType ai)</pre>
<p>
Extends <em>Sprite_filler</em>.
</p>
<dl>
</dl>
</div>

<div><a name = "Debris"><!-- --></a>
<h3>Debris</h3>
<pre>struct Debris * <b>Debris</b> (const struct AutoDebris *const class,
	const struct Ortho3f *const x)</pre>
<p>
Extends <em>Sprite_filler</em>.
</p>
<dl>
</dl>
</div>

<div><a name = "Wmd"><!-- --></a>
<h3>Wmd</h3>
<pre>struct Wmd * <b>Wmd</b> (const struct AutoWmdType *const class,
	const struct Ship *const from)</pre>
<p>
Extends <em>Sprite_filler</em>.
</p>
<dl>
</dl>
</div>

<div><a name = "Gate"><!-- --></a>
<h3>Gate</h3>
<pre>struct Gate * <b>Gate</b> (const struct AutoGate *const class)</pre>
<p>
Extends <em>Sprite_filler</em>.
</p>
<dl>
</dl>
</div>

<div><a name = "Sprites"><!-- --></a>
<h3>Sprites</h3>
<pre>int <b>Sprites</b> (void)</pre>
<p>
Initailises all sprite buffers.
</p>
<dl>
	<dt>return</dt>
	<dd>Success.</dd>
</dl>
</div>

<div><a name = "Sprites_"><!-- --></a>
<h3>Sprites_</h3>
<pre>void <b>Sprites_</b> (void)</pre>
<p>
Erases all sprite buffers.
</p>
<dl>
</dl>
</div>

<div><a name = "SpritesDrawInfo"><!-- --></a>
<h3>SpritesDrawInfo</h3>
<pre>void <b>SpritesDrawInfo</b> (InfoOutput draw)</pre>
<p>
Must call <a href = "#SpriteUpdate">SpriteUpdate</a> before this, because it updates everything.
Use when the Info GPU shader is loaded.
</p>
<dl>
</dl>
</div>

<div><a name = "SpritesDrawLambert"><!-- --></a>
<h3>SpritesDrawLambert</h3>
<pre>void <b>SpritesDrawLambert</b> (LambertOutput draw)</pre>
<p>
Must call <a href = "#SpriteUpdate">SpriteUpdate</a> before this, because it updates everything.
Use when the Lambert GPU shader is loaded.
</p>
<dl>
</dl>
</div>

<div><a name = "SpritesPlot"><!-- --></a>
<h3>SpritesPlot</h3>
<pre>void <b>SpritesPlot</b> (void)</pre>
<p>
Debugging plot.
</p>
<dl>
	<dt>implements</dt>
	<dd>Action</dd>
</dl>
</div>

<div><a name = "SpriteDebris"><!-- --></a>
<h3>SpriteDebris</h3>
<pre>void <b>SpriteDebris</b> (const struct Sprite *const s)</pre>
<p>
Spawns smaller Debris (fixme: stub.)
</p>
<dl>
</dl>
</div>

<div><a name = "Debris"><!-- --></a>
<h3>Debris</h3>
<pre>int <b>Debris</b> (const struct AutoDebris *const class,
	struct Ortho3f *r, const struct Ortho3f *v)</pre>
<p>
Constructor.
</p>
<dl>
	<dt>return</dt>
	<dd>Success.</dd>
</dl>
</div>

<div><a name = "Ship"><!-- --></a>
<h3>Ship</h3>
<pre>struct Ship * <b>Ship</b> (const struct AutoShipClass *const class,
	struct Ortho3f *const r, const enum SpriteBehaviour behaviour)</pre>
<p>
Constructor.
</p>
<dl>
	<dt>return</dt>
	<dd>Newly created ship or null.</dd>
</dl>
</div>

<div><a name = "Gate"><!-- --></a>
<h3>Gate</h3>
<pre>int <b>Gate</b> (const struct AutoGate *const class)</pre>
<p>
Constructor.
</p>
<dl>
	<dt>return</dt>
	<dd>Success.</dd>
</dl>
</div>

<div><a name = "Sprite"><!-- --></a>
<h3>Sprite</h3>
<pre>int <b>Sprite</b> (void)</pre>
<p>
Initailises all sprite buffers.
</p>
<dl>
	<dt>return</dt>
	<dd>Success.</dd>
</dl>
</div>

<div><a name = "Sprite_"><!-- --></a>
<h3>Sprite_</h3>
<pre>void <b>Sprite_</b> (void)</pre>
<p>
Erases all sprite buffers.
</p>
<dl>
</dl>
</div>

<div><a name = "SpriteOut"><!-- --></a>
<h3>SpriteOut</h3>
<pre>void <b>SpriteOut</b> (struct Sprite *const this)</pre>
<p>
Prints out debug info.
</p>
<dl>
</dl>
</div>

<div><a name = "SpriteUpdate"><!-- --></a>
<h3>SpriteUpdate</h3>
<pre>void <b>SpriteUpdate</b> (const int frame_ms)</pre>
<p>
This is where most of the work gets done. Called every frame, O(n).
</p>
<dl>
	<dt>parameter: frame_ms</dt>
	<dd>Milliseconds since the last frame.</dd>
</dl>
</div>

<div><a name = "SpriteListBin"><!-- --></a>
<h3>SpriteListBin</h3>
<pre>inline const struct SpriteList * <b>SpriteListBin</b> (struct Vec2u bin2)</pre>
<dl>
	<dt>return</dt>
	<dd>The first sprite in the <em>bin2</em>.</dd>
	<dt>fixme</dt>
	<dd>C99</dd>
</dl>
</div>

<div><a name = "SpriteExtractDrawing"><!-- --></a>
<h3>SpriteExtractDrawing</h3>
<pre>inline void <b>SpriteExtractDrawing</b> (const struct Sprite *const this,
	const struct Ortho3f **const r_ptr, unsigned *const image_ptr,
	unsigned *const normals_ptr, const struct Vec2u **const size_ptr)</pre>
<dl>
	<dt>fixme</dt>
	<dd>C99</dd>
</dl>
</div>

<div><a name = "ShipGetHit"><!-- --></a>
<h3>ShipGetHit</h3>
<pre>void <b>ShipGetHit</b> (const struct Ship *const this, struct Vec2u *const hit)</pre>
<p>
<em>hit</em> will be filled with <em>x</em> hit, <em>y</em> max hit.
</p>
<dl>
</dl>
</div>

<div><a name = "WmdGetDamage"><!-- --></a>
<h3>WmdGetDamage</h3>
<pre>int <b>WmdGetDamage</b> (const struct Wmd *const this)</pre>
<p>
Accessor.
</p>
<dl>
</dl>
</div>

<div><a name = "GateGetTo"><!-- --></a>
<h3>GateGetTo</h3>
<pre>const struct AutoSpaceZone * <b>GateGetTo</b> (const struct Gate *const this)</pre>
<p>
Gets a SpaceZone that it goes to, if it exists.
</p>
<dl>
</dl>
</div>

<div><a name = "GateFind"><!-- --></a>
<h3>GateFind</h3>
<pre>struct Gate * <b>GateFind</b> (struct AutoSpaceZone *const to)</pre>
<p>
Linear search for <em>gates</em> that go to a specific place.
</p>
<dl>
</dl>
</div>


</body>
</html>
